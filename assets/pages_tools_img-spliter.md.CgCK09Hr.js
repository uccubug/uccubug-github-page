import{ab as M,ac as D,p as g,h as P,o as S,c as _,Y as x,Z as O,j as l,k as F,t as y,n as A,N as b,ae as G,G as C,F as E,C as I,ad as k,a as U}from"./chunks/framework.D3EZea2i.js";import"./chunks/dayjs.min.CxMP4GVf.js";function $(){let r,i;return{promise:new Promise((e,s)=>{r=e,i=s}),resolve:r,reject:i}}function R(r,i=!0){const{promise:t,resolve:e,reject:s}=$(),o=new FileReader,n={};return o.readAsDataURL(r),o.onload=p=>{const d=p.target.result;if(n.url=d,!i){const v=new Image;v.src=d,n.element=v}e(n)},t}const j="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",X=["src"],V=["accept"],W={class:"fc-content"},Z={__name:"index",props:M(G({content:String,width:Number,height:Number,accept:String,imgMod:Boolean},{content:"选择文件",width:"100",height:"100",accept:"image/*",imgMod:!0}),{file:{default:null},fileModifiers:{}}),emits:M(["onChange"],["update:file"]),setup(r,{emit:i}){const t=D(r,"file"),e=g(""),s=i,o=P(()=>r.imgMod&&r.accept.startsWith("image/")),n=p=>{var v,T;const d=((T=(v=p==null?void 0:p.target)==null?void 0:v.files)==null?void 0:T[0])||null;t.value=d,o&&R(d).then(w=>{e.value=w.url}),s("onChange",d)};return(p,d)=>(S(),_("div",{class:A(["fc-wrap",{withBg:o.value,hasBg:!!e.value}]),style:b({width:`${r.width}px`,height:`${r.height}px`})},[x(l("img",{src:e.value||F(j),class:"fc-img"},null,8,X),[[O,o.value]]),l("input",{class:"file-chooser",type:"file",accept:r.accept,onChange:n},null,40,V),l("div",W,y(r.content),1)],6))}},c={NINE_3x3:0,SIX_2x3:1,SIX_3x2:2,THREE_1x3:3,THREE_3x1:4},u={TOP_LEFT:0,LEFT:1,BOTTOM_LEFT:2,TOP:3,CENTER:4,BOTTOM:5,TOP_RIGHT:6,RIGHT:7,BOTTOM_RIGHT:8};class q{constructor(i,t){this.img=i,this.imgSize=(i==null?void 0:i.size)||{width:0,height:0},this.options={mode:c.NINE_3x3,minPad:0,align:u.CENTER,bg:"#fff",...t},this.cvsSize=void 0,this.perSize=void 0,i&&this.updateCvsAndPerSize()}splitToCvs(){const i=[],t=document.createElement("canvas");t.width=this.cvsSize.width,t.height=this.cvsSize.height;const e=t.getContext("2d",{willReadFrequently:!0});e.fillStyle=this.options.bg,e.fillRect(0,0,t.width,t.height);const[s,o]=this.getPaintIndex();e.drawImage(this.img,0,0,this.imgSize.width,this.imgSize.height,s,o,this.imgSize.width,this.imgSize.height);let n,p=0;const d=this.splitPartsIdxGenerator();for(n=d.next();!n.done;)i.push(this.genCvs(e.getImageData(...n.value),`${p}.jpg`)),p++,n=d.next();return i}updateParams(i=null,t=this.options){this.options={...this.options,...t},i&&(this.img=i,this.imgSize={widht:i.width,height:i.height}),this.updateCvsAndPerSize()}updateCvsAndPerSize(){const i=this.imgSize.width+this.options.minPad*2,t=this.imgSize.height+this.options.minPad*2;let e,s,o,n;this.perSize={},this.cvsSize={},this.options.mode===c.NINE_3x3?(e=Math.ceil(Math.max(i,t)/3)*3,s=e/3,o=e,n=e):this.options.mode===c.THREE_1x3?(i<=t*3?e=t*3:e=Math.ceil(i/3)*3,s=e/3,o=e,n=s):this.options.mode===c.THREE_3x1?(t<=i*3?e=i*3:e=Math.ceil(t/3)*3,s=e/3,o=s,n=e):this.options.mode===c.SIX_2x3?(i>t*3/2?(e=Math.ceil(i/3)*3,s=e/3):(s=Math.ceil(t/2),e=s*3),s=e/3,o=e,n=2*s):this.options.mode===c.SIX_3x2&&(t>i*3/2?(e=Math.ceil(t/3)*3,s=e/3):(s=Math.ceil(i/2),e=s*3),s=e/3,o=2*s,n=e),this.perSize={width:s,height:s},this.cvsSize={width:o,height:n}}getPaintIndex(){const i=this.imgSize.width+this.options.minPad*2,t=this.imgSize.height+this.options.minPad*2,e=this.cvsSize.width,s=this.cvsSize.height;let o=0,n=0;switch(this.options.align){case u.TOP_LEFT:break;case u.LEFT:n=(s-t)/2;break;case u.BOTTOM_LEFT:n=s-t;break;case u.TOP:o=(e-i)/2;break;case u.CENTER:o=(e-i)/2,n=(s-t)/2;break;case u.BOTTOM:o=(e-i)/2,n=s-t;break;case u.TOP_RIGHT:o=e-i;break;case u.RIGHT:o=e-i,n=(s-t)/2;break;case u.BOTTOM_RIGHT:o=e-i,n=s-t;break}return[o+this.options.minPad,n+this.options.minPad]}*splitPartsIdxGenerator(){for(let i=0;i<3;i++)if(this.options.mode===c.THREE_1x3)yield[i*this.perSize.width,0,this.perSize.width,this.perSize.height];else if(this.options.mode===c.THREE_3x1)yield[0,i*this.perSize.width,this.perSize.width,this.perSize.height];else if([c.SIX_2x3,c.SIX_3x2,c.NINE_3x3].includes(this.options.mode))for(let t=0;t<3;t++)if(this.options.mode===c.SIX_2x3){if(t===2)break;const e=i*2+t,s=e%3,o=Math.floor(e/3);yield[s*this.perSize.width,o*this.perSize.height,this.perSize.width,this.perSize.height]}else if(this.options.mode===c.SIX_3x2){if(t===2)break;yield[t*this.perSize.width,i*this.perSize.height,this.perSize.width,this.perSize.height]}else yield[t*this.perSize.width,i*this.perSize.height,this.perSize.width,this.perSize.height]}loadImageData(i,t){const e=document.createElement("canvas"),s=e.getContext("2d"),o=document.createElement("a");o.download=t,e.width=this.perSize.width,e.height=this.perSize.height,s.putImageData(i,0,0),o.href=e.toDataURL("image/jpeg"),o.click()}genCvs(i,t){const e=document.createElement("canvas"),s=e.getContext("2d");return e.width=this.perSize.width,e.height=this.perSize.height,e.title=t,s.putImageData(i,0,0),e.addEventListener("click",()=>{const o=document.createElement("a");o.download=t,o.href=e.toDataURL("image/jpeg"),o.click()}),e}}const J={creater(r,i){const t=new q(r,i);return new Proxy(t,{set(e,s,o){return e[s]=o,s==="img"&&(e.imgSize={width:o.width,height:o.height}),e.updateCvsAndPerSize(),!0}})}},Q={class:"img-spliter-box"},Y={class:"row1 box-row"},K={class:"left-img-preview"},ee={class:"dld-tip"},te={class:"right-options"},ie={class:"split-mod option"},se={class:"mod-options"},oe=["title","onClick"],ne={class:"align-mod option"},ae={class:"mod-options"},le=["onClick"],he={class:"option option-inline"},re={class:"padding"},ce={class:"color"},de={__name:"index",setup(r){const i=g(),t=g(null),e=g(u.CENTER),s=g(c.NINE_3x3),o=g(3),n=g(3),p=g(null),d=g(0),v=g("#ffffff"),T=J.creater(),w=g(!1),L=(m,h)=>{s.value=m,o.value=h},N=P(()=>{const m=[];for(const h in c){const a=h.split("_"),f=a[1].split("x"),z=parseInt(f[0])*parseInt(f[1]);m.push({title:a[1],value:c[h],total:z,key:h,cols:parseInt(f[1])})}return m}),B=P(()=>{const m=[],h={TOP_LEFT:"↖",TOP:"↑",TOP_RIGHT:"↗",LEFT:"←",CENTER:"·",RIGHT:"→",BOTTOM_LEFT:"↙",BOTTOM:"↓",BOTTOM_RIGHT:"↘"};for(const a in h)m.push({key:a,char:h[a],value:u[a]});return m}),H=async()=>{const m={...T.options,minPad:d.value,bg:v.value,align:e.value,mode:s.value};if(T.options=m,!t.value){alert("请先选择图片");return}const{url:h,element:a}=await R(t.value,!1);i.value=h,T.img=a;const f=T.splitToCvs();n.value=o.value,w.value=!0,p.value.innerHTML="",f.forEach(z=>{p.value.appendChild(z)})};return(m,h)=>(S(),_("div",Q,[l("div",Y,[l("div",K,[C(Z,{file:t.value,"onUpdate:file":h[0]||(h[0]=a=>t.value=a),content:"选择图片",width:260,height:160},null,8,["file"]),x(l("div",ee,"点击图片进行下载",512),[[O,w.value]]),l("div",{ref_key:"imgsShowBox",ref:p,class:"parts-preview",style:b({"--col":n.value})},null,4)]),l("div",te,[l("div",ie,[h[3]||(h[3]=l("div",{class:"label"},"分割模式",-1)),l("div",se,[(S(!0),_(E,null,I(N.value,a=>(S(),_("div",{class:A(["mod-option",{active:a.value===s.value}]),style:b({"--cols":a.cols}),title:a.title,onClick:f=>L(a.value,a.cols),key:a.key},[(S(!0),_(E,null,I(a.total,f=>(S(),_("div",{key:f}))),128))],14,oe))),128))])]),l("div",ne,[h[4]||(h[4]=l("div",{class:"label"},"对齐模式",-1)),l("div",ae,[(S(!0),_(E,null,I(B.value,a=>(S(),_("div",{onClick:f=>e.value=a.value,class:A({active:a.value===e.value}),key:a.key},y(a.char),11,le))),128))])]),l("div",he,[l("div",re,[h[5]||(h[5]=l("div",{class:"label"},"边距",-1)),x(l("input",{type:"number",max:"4000",min:"0","onUpdate:modelValue":h[1]||(h[1]=a=>d.value=a)},null,512),[[k,d.value]])]),l("div",ce,[h[6]||(h[6]=l("div",{class:"label"},"背景颜色",-1)),x(l("input",{type:"color","onUpdate:modelValue":h[2]||(h[2]=a=>v.value=a)},null,512),[[k,v.value]])])]),l("div",{class:"start-btn-wrap"},[l("button",{onClick:H,type:"button",class:"start-btn"},"点击开始")])])])]))}},me=JSON.parse('{"title":"图像分割","description":"","frontmatter":{"title":"图像分割","password1":"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92","createTime":"2024-10-24T20:39:30.000Z"},"headers":[],"relativePath":"pages/tools/img-spliter.md","filePath":"pages/tools/img-spliter.md","lastUpdated":1729922683000}'),pe={name:"pages/tools/img-spliter.md"},ve=Object.assign(pe,{setup(r){return(i,t)=>(S(),_("div",{"data-pagefind-body":!0},[t[0]||(t[0]=l("h1",{id:"图像分割器",tabindex:"-1"},[U("图像分割器 "),l("a",{class:"header-anchor",href:"#图像分割器","aria-label":'Permalink to "图像分割器"'},"​")],-1)),t[1]||(t[1]=l("hr",null,null,-1)),C(de)]))}});export{me as __pageData,ve as default};

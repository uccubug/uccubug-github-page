import{ab as k,ac as D,p as g,h as b,o as S,c as T,j as r,t as O,n as M,N as P,ae as F,G as C,Y as z,Z as G,F as E,C as I,ad as y,a as U}from"./chunks/framework.D3EZea2i.js";import"./chunks/dayjs.min.CxMP4GVf.js";function $(){let h,i;return{promise:new Promise((e,s)=>{h=e,i=s}),resolve:h,reject:i}}function R(h,i=!0){const{promise:t,resolve:e,reject:s}=$(),o=new FileReader,n={};return o.readAsDataURL(h),o.onload=d=>{const u=d.target.result;if(n.url=u,!i){const v=new Image;v.src=u,n.element=v}e(n)},t}const j=["accept"],X={class:"fc-content"},A={__name:"index",props:k(F({content:String,width:Number,height:Number,accept:String,imgMod:Boolean},{content:"选择文件",width:"100",height:"100",accept:"image/*",imgMod:!0}),{file:{default:null},fileModifiers:{}}),emits:k(["onChange"],["update:file"]),setup(h,{emit:i}){const t=D(h,"file"),e=g(""),s=i,o=b(()=>h.imgMod&&h.accept.startsWith("image/")),n=d=>{var v,_;const u=((_=(v=d==null?void 0:d.target)==null?void 0:v.files)==null?void 0:_[0])||null;t.value=u,o&&R(u).then(w=>{e.value=w.url}),s("onChange",u)};return(d,u)=>(S(),T("div",{class:M(["fc-wrap",{withBg:o.value,hasBg:!!e.value}]),style:P({width:`${h.width}px`,height:`${h.height}px`,"--bg":`url(${e.value})`})},[r("input",{class:"file-chooser",type:"file",accept:h.accept,onChange:n},null,40,j),r("div",X,O(h.content),1)],6))}},c={NINE_3x3:0,SIX_2x3:1,SIX_3x2:2,THREE_1x3:3,THREE_3x1:4},p={TOP_LEFT:0,LEFT:1,BOTTOM_LEFT:2,TOP:3,CENTER:4,BOTTOM:5,TOP_RIGHT:6,RIGHT:7,BOTTOM_RIGHT:8};class V{constructor(i,t){this.img=i,this.imgSize=(i==null?void 0:i.size)||{width:0,height:0},this.options={mode:c.NINE_3x3,minPad:0,align:p.CENTER,bg:"#fff",...t},this.cvsSize=void 0,this.perSize=void 0,i&&this.updateCvsAndPerSize()}splitToCvs(){const i=[],t=document.createElement("canvas");t.width=this.cvsSize.width,t.height=this.cvsSize.height;const e=t.getContext("2d",{willReadFrequently:!0});e.fillStyle=this.options.bg,e.fillRect(0,0,t.width,t.height);const[s,o]=this.getPaintIndex();return e.drawImage(this.img,0,0,this.imgSize.width,this.imgSize.height,s,o,this.imgSize.width,this.imgSize.height),Array.from(this.splitPartsIdxGenerator()),this.splitPartsIdxGenerator().forEach((n,d)=>{i.push(this.genCvs(e.getImageData(...n),`${d}.jpg`))}),i}updateCvsAndPerSize(){const i=this.imgSize.width+this.options.minPad*2,t=this.imgSize.height+this.options.minPad*2;let e,s,o,n;this.perSize={},this.cvsSize={},this.options.mode===c.NINE_3x3?(e=Math.ceil(Math.max(i,t)/3)*3,s=e/3,o=e,n=e):this.options.mode===c.THREE_1x3?(i<=t*3?e=t*3:e=Math.ceil(i/3)*3,s=e/3,o=e,n=s):this.options.mode===c.THREE_3x1?(t<=i*3?e=i*3:e=Math.ceil(t/3)*3,s=e/3,o=s,n=e):this.options.mode===c.SIX_2x3?(i>t*3/2?(e=Math.ceil(i/3)*3,s=e/3):(s=Math.ceil(t/2),e=s*3),s=e/3,o=e,n=2*s):this.options.mode===c.SIX_3x2&&(t>i*3/2?(e=Math.ceil(t/3)*3,s=e/3):(s=Math.ceil(i/2),e=s*3),s=e/3,o=2*s,n=e),this.perSize={width:s,height:s},this.cvsSize={width:o,height:n}}getPaintIndex(){const i=this.imgSize.width+this.options.minPad*2,t=this.imgSize.height+this.options.minPad*2,e=this.cvsSize.width,s=this.cvsSize.height;let o=0,n=0;switch(this.options.align){case p.TOP_LEFT:break;case p.LEFT:n=(s-t)/2;break;case p.BOTTOM_LEFT:n=s-t;break;case p.TOP:o=(e-i)/2;break;case p.CENTER:o=(e-i)/2,n=(s-t)/2;break;case p.BOTTOM:o=(e-i)/2,n=s-t;break;case p.TOP_RIGHT:o=e-i;break;case p.RIGHT:o=e-i,n=(s-t)/2;break;case p.BOTTOM_RIGHT:o=e-i,n=s-t;break}return[o+this.options.minPad,n+this.options.minPad]}*splitPartsIdxGenerator(){for(let i=0;i<3;i++)if(this.options.mode===c.THREE_1x3)yield[i*this.perSize.width,0,this.perSize.width,this.perSize.height];else if(this.options.mode===c.THREE_3x1)yield[0,i*this.perSize.width,this.perSize.width,this.perSize.height];else if([c.SIX_2x3,c.SIX_3x2,c.NINE_3x3].includes(this.options.mode))for(let t=0;t<3;t++)if(this.options.mode===c.SIX_2x3){if(t===2)break;const e=i*2+t,s=e%3,o=Math.floor(e/3);yield[s*this.perSize.width,o*this.perSize.height,this.perSize.width,this.perSize.height]}else if(this.options.mode===c.SIX_3x2){if(t===2)break;yield[t*this.perSize.width,i*this.perSize.height,this.perSize.width,this.perSize.height]}else yield[t*this.perSize.width,i*this.perSize.height,this.perSize.width,this.perSize.height]}loadImageData(i,t){const e=document.createElement("canvas"),s=e.getContext("2d"),o=document.createElement("a");o.download=t,e.width=this.perSize.width,e.height=this.perSize.height,s.putImageData(i,0,0),o.href=e.toDataURL("image/jpeg"),o.click()}genCvs(i,t){const e=document.createElement("canvas"),s=e.getContext("2d");return e.width=this.perSize.width,e.height=this.perSize.height,e.title=t,s.putImageData(i,0,0),e.addEventListener("click",()=>{const o=document.createElement("a");o.download=t,o.href=e.toDataURL("image/jpeg"),o.click()}),e}}const W={creater(h,i){const t=new V(h,i);return new Proxy(t,{set(e,s,o){return e[s]=o,s==="img"&&(e.imgSize={width:o.width,height:o.height}),e.updateCvsAndPerSize(),!0}})}},Z={class:"img-spliter-box"},q={class:"row1 box-row"},J={class:"left-img-preview"},Y={class:"dld-tip"},K={class:"right-options"},Q={class:"split-mod option"},ee={class:"mod-options"},te=["title","onClick"],ie={class:"align-mod option"},se={class:"mod-options"},oe=["onClick"],ae={class:"option option-inline"},ne={class:"padding"},le={class:"color"},re={__name:"index",setup(h){const i=g(),t=g(null),e=g(p.CENTER),s=g(c.NINE_3x3),o=g(3),n=g(3),d=g(null),u=g(0),v=g("#ffffff"),_=W.creater(),w=g(!1),N=(m,l)=>{s.value=m,o.value=l},L=b(()=>{const m=[];for(const l in c){const a=l.split("_"),f=a[1].split("x"),x=parseInt(f[0])*parseInt(f[1]);m.push({title:a[1],value:c[l],total:x,key:l,cols:parseInt(f[1])})}return m}),H=b(()=>{const m=[],l={TOP_LEFT:"↖",TOP:"↑",TOP_RIGHT:"↗",LEFT:"←",CENTER:"·",RIGHT:"→",BOTTOM_LEFT:"↙",BOTTOM:"↓",BOTTOM_RIGHT:"↘"};for(const a in l)m.push({key:a,char:l[a],value:p[a]});return m}),B=async()=>{const m={..._.options,minPad:u.value,bg:v.value,align:e.value,mode:s.value};if(_.options=m,!t.value){alert("请先选择图片");return}const{url:l,element:a}=await R(t.value,!1);i.value=l,_.img=a;const f=_.splitToCvs();n.value=o.value,w.value=!0,d.value.innerHTML="",f.forEach(x=>{d.value.appendChild(x)})};return(m,l)=>(S(),T("div",Z,[r("div",q,[r("div",J,[C(A,{file:t.value,"onUpdate:file":l[0]||(l[0]=a=>t.value=a),content:"选择图片",width:260,height:160},null,8,["file"]),z(r("div",Y,"点击图片进行下载",512),[[G,w.value]]),r("div",{ref_key:"imgsShowBox",ref:d,class:"parts-preview",style:P({"--col":n.value})},null,4)]),r("div",K,[r("div",Q,[l[3]||(l[3]=r("div",{class:"label"},"分割模式",-1)),r("div",ee,[(S(!0),T(E,null,I(L.value,a=>(S(),T("div",{class:M(["mod-option",{active:a.value===s.value}]),style:P({"--cols":a.cols}),title:a.title,onClick:f=>N(a.value,a.cols),key:a.key},[(S(!0),T(E,null,I(a.total,f=>(S(),T("div",{key:f}))),128))],14,te))),128))])]),r("div",ie,[l[4]||(l[4]=r("div",{class:"label"},"对齐模式",-1)),r("div",se,[(S(!0),T(E,null,I(H.value,a=>(S(),T("div",{onClick:f=>e.value=a.value,class:M({active:a.value===e.value}),key:a.key},O(a.char),11,oe))),128))])]),r("div",ae,[r("div",ne,[l[5]||(l[5]=r("div",{class:"label"},"边距",-1)),z(r("input",{type:"number",max:"4000",min:"0","onUpdate:modelValue":l[1]||(l[1]=a=>u.value=a)},null,512),[[y,u.value]])]),r("div",le,[l[6]||(l[6]=r("div",{class:"label"},"背景颜色",-1)),z(r("input",{type:"color","onUpdate:modelValue":l[2]||(l[2]=a=>v.value=a)},null,512),[[y,v.value]])])]),r("div",{class:"start-btn-wrap"},[r("button",{onClick:B,type:"button",class:"start-btn"},"点击开始")])])])]))}},pe=JSON.parse('{"title":"图像分割","description":"","frontmatter":{"title":"图像分割","password1":"8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92","createTime":"2024-10-24T20:39:30.000Z"},"headers":[],"relativePath":"pages/tools/img-spliter.md","filePath":"pages/tools/img-spliter.md","lastUpdated":null}'),he={name:"pages/tools/img-spliter.md"},ue=Object.assign(he,{setup(h){return(i,t)=>(S(),T("div",{"data-pagefind-body":!0},[t[0]||(t[0]=r("h1",{id:"图像分割器",tabindex:"-1"},[U("图像分割器 "),r("a",{class:"header-anchor",href:"#图像分割器","aria-label":'Permalink to "图像分割器"'},"​")],-1)),t[1]||(t[1]=r("hr",null,null,-1)),C(re)]))}});export{pe as __pageData,ue as default};
